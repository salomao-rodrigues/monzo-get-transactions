'use strict';var _express=require('express'),_express2=_interopRequireDefault(_express),_monzoApi=require('monzo-api'),_monzoApi2=_interopRequireDefault(_monzoApi),_jsonfile=require('jsonfile'),_jsonfile2=_interopRequireDefault(_jsonfile),_config=require('./config'),_config2=_interopRequireDefault(_config);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var TRANSACTIONS_FILE='transactions.json',userId=_config2.default.userId,accountId=_config2.default.accountId,accessToken=_config2.default.accessToken,host=_config2.default.host,port=_config2.default.port,app=(0,_express2.default)(),monzoApi=new _monzoApi2.default(userId,accessToken),serverHandler;monzoApi.redirectUrl=host+':'+port+'/monzo-redirect',app.get('/',function(a,b){b.send('<a href="/login">Login with Monzo</a>')}),app.get('/login',function(a,b){b.redirect(monzoApi.authorizationUrl)}),app.get('/monzo-redirect',function(a,b){var c=a.query,d=c.code,e=c.state;monzoApi.authenticate(d,e).then(function(){monzoApi.transactions(accountId).then(function(f){_jsonfile2.default.writeFileSync(TRANSACTIONS_FILE,f,{flag:'w'}),b.send('Transactions have been saved to '+TRANSACTIONS_FILE),serverHandler.close()}).catch(console.error)}).catch(console.error)}),serverHandler=app.listen(port,function(){console.log('Monzo app listening on '+host+':'+port+' !')});